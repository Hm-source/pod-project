## ✅ 화요일(8월 26일)

---

### 비지니스 시나리오 / 요구사항 : POD 주문제작 상품 커머스 → ERD 설계

> 클라이언트 혹은 기획자로부터 정돈되지 않은 요구사항을 받아서 ERD 설계를 먼저 시작한다
> 이번 실습은 혼자하는것이기에 모든 비지니스 시나리오를 다 다루지 않도록 하였는데,
> 이전에 다루었던 POD 주문제작 상품 커머스의 비지니스 시나리오 중 일부만을 떼어 유저와 상품에 집중한다
>

### 유저

> 유저는 판매자만 존재하고 구매자도, 관리자 계정도 존재하지 않는다 단 한 종류의 판매자 계정만 신경써라
>

- 유저는 판매자만 존재한다
- 유저 로그인은 아이디 / 비밀번호 방식만 존재한다 (OAuth2, SSO 등은 모두 고려하지 않는다)
- 유저 아이디는 회원가입할때 중복되선 안되기에 UNIQUE 제약조건을 걸어야한다
- 유저 패스워드는 단방향 암호화 (단방향 해시라고도 부름) 를 통해 해시값을 저장해야한다

### **베이스 제품과 상품**

> 베이스 제품은 머그컵이나 쿠션 같은것, 상품은 베이스 제품에 여러분들이 업로드한 사진이 붙어 판매되는것
>

- 판매자 유저는 제품 생산공장 없이도 상품을 등록해서 판매할 수 있다
- 유저는 자신의 그림만 업로드하면 베이스 제품에 해당 사진이 덧붙여진 상품이미지가 판매글로 업로드된다
- 상품의 구성은 베이스 제품과 POD 의뢰한 사진으로 구성된다
- 상품 내 사진의 개수는 여러개가 될 수 있다
    - 예) 내가 키우는 고양이 사진 2장과 꽃 사진 1장 그리고 내 얼굴 사진 1장
- 상품은 수량이 존재하지 않고 매번 주문을 받는 순간 제작에 돌입된다
- 베이스 제품에는 가격이 있어서, 어떤 상품이든지 동일한 베이스 제품이면 동일한 가격을 갖는다
- 베이스 제품에는 사이즈, 색상, 선택 옵션이 있고 제품 재료 혹은 재질에 대한 옵션도 함께 갖고있다
    - 예) 머그컵 베이스 제품에 S 사이즈 옵션과 유리 재질 옵션 (어떤것은 재질이 따로 구별되어있지 않다)
- 하지만 어떤 베이스 제품에는 재질은 모두 동일하기에 재질에 대한 옵션은 존재하지 않는다

### 상품 내 이미지에 대한 내부 리뷰

> 베이스 제품은 머그컵이나 쿠션 같은것, 상품은 베이스 제품에 여러분들이 업로드한 사진이 붙어 판매되는것
>

- 판매자가 부적합한 사진을 베이스 제품에 덧붙여서 판매하는걸 방지하기 위해 내부 리뷰과정을 거친다
    - 19세 이상만 볼 수 있는 부적합한 사진을 사용한다거나 / 잔인하거나 정상적이지 않은 사진에 대한 리뷰
- 내부 리뷰과정은 [ 등록 > 승인 / 거절 > 금지 ] 총 4가지의 상태를 갖는다
- 내부 리뷰과정 중 승인이 되어야지만이 비로소 판매가 가능한 상태가 된다 / 그 전엔 상품이 미노출되어야한다
- 내부 리뷰과정의 절차는 히스토리 테이블로 적재하여 추적이 되어야한다 (관리자 계정은 없으니 시간만 기입)
    - 예) 등록 > 승인 > 금지 > 승인 : 처음 등록했을땐 승인했으나 중간에 판매금지를 잠깐하였고 다시 재승인

## ✅ 수요일(8월 27일)

---

### API 요구사항 → 스프링 프로젝트를 통해 API 개발

> 앞서 설계한 ERD 기반으로 필요한 API 를 제공하기위해 @Controller 와 DTO 클래스 정의 및 개발 필요
> API 파라미터와 반환값에 대한 제약사항도 함께 요구사항으로 전달하니 꼼꼼히 읽고 개발할것
>
[POD-erd-2.png](https://postimg.cc/HjSrk7y8)

1. **아이디 / 패스워드 기반 로그인 API** = **BASIC 인증 설정만 하면되고 따로 개발하지 않는다**
2. **유저 회원가입 API**
    - 요청 : **아이디 + 패스워드**
    - 반환 : **가입이 완료된 유저정보를 할당된 ID 와 함께 반환한다**
    - 에러 : **기존에 가입된 유저 아이디와 같은 아이디를 입력받았다면 중복계정 존재 에러를 반환한다**
    - 에러 : **아이디와 패스워드에 대해 최소최대 길이에 대한 제약을 둔다**
        - 검증 : **아이디는 최소 5자여야하고, 최대 10자여야한다**
        - 검증 : **비밀번호는 최소 8자여야하고, 대문자와 소문자 각각 최소 1개는 포함되어있어야한다**
3. **사진 업로드를 통한 상품 생성 API**
    - 요청 : **베이스 제품 ID + 상품 이름 + 여러장의 사진** (최소 1장, 최대 5장)
    - 반환 : **등록이 완료된 상품 정보를 반환한다**
    - 에러 : **베이스 제품 ID 가 존재하지않는다면 존재하지 않는 베이스 제품 에러를 반환한다**
    - 에러 : **사진개수와 상품이름의 길이에 대한 제약을 둔다**
        - 검증 : **사진은 최소 1장이어야하고, 최대 5장이어야한다**
        - 검증 : **상품이름은 최대 20자여야한다**
4. **현재 로그인한 유저가 등록한 상품 조회 API**
    - 요청 : (없음)
        - **~~중요 : FORM 로그인 성공 후 그 로그인에 해당하는 유저정보** ← JSESSIONID~~ → 어려울 수 있어서
        - **중요 : BASIC 을 통해 API 호출할 수 있도록 한다** (매번 ID/PW 를 Base64 로 변환해서 전달)
    - 반환 : **현재 로그인한 유저가 등록한 상품 정보들을 반환한다** (승인 / 거절 / 금지 여부 모두 상관없이)
        - 만약 등록한 상품이 없다면 빈 배열을 반환하면된다
        - 각 상품마다 내부 리뷰과정 히스토리 과정을 모두 배열로 함께 반환해야한다
            - 예) 언제 승인되었고 언제 거절되었고 언제 금지되었고 언제 다시 승인되었는지 등의 정보
    - 에러 : **로그인한 유저가 없다면 현재 로그인되지 않았기에 로그인이 필요하다는 에러를 반환한다**
5. **등록된 모든 상품 조회 API**
    - 요청 : **사이즈 + 페이지** (페이지네이션)
        - 예) 사이즈 10개 / 3번째 페이지 = 21번째부터 30번째까지의 상품을 조회한다
    - 반환 : **다양한 판매자로부터 등록 후 성공적으로 승인받은 상품들의 정보만을 반환한다**
        - 등록 / 승인 / 거절 / 금지 4가지 상태 중 승인 상태인 상품만을 반환해야한다
        - 내부 리뷰과정 히스토리와 같은 민감한 정보는 출력할 필요가 없다 = 외부 유저가 보는것이기에
6. **등록된 상품에 대한 내부 리뷰 API**
    - 요청 : **상품 ID + 변경하고자 하는 상태**
    - 반환 : **변경된 상태의 상품 정보를 내부 리뷰과정 히스토리와 함께 반환한다**
    - 에러 : **상품 ID 가 존재하지않는다면 존재하지 않는 상품 에러를 반환한다**
    - 에러 : **상태가 변경될때에는 이전 상태가 과연 요청한 상태로 변경이 가능한것인지 확인이 필요하다**
        - **등록 / 거절 / 금지**일때만 > **승인**으로 변경 가능
        - **등록**                    일때만 > **거절**으로 변경 가능
        - **승인**                    일때만 > **금지**으로 변경 가능

## ✅ 목요일(8월 28일) + 금요일(8월 29일)

---

## 기술 요구사항

> 수요일날부터 목요일까지 API 개발을 계속 이어서 진행할때 아래의 내용들을 고려하여야한다
> 만약 API 개발하는것만으로도 힘들다면 아래 요구사항을 제외하고 API 만 잘돌아가게 만드는것을 우선하자
> 그리고 나서 금요일날에 도입해도 된다
>

- API 요구사항 중 필요에 따라 요청에 대해 **@Valid** 통해 @Controller 에서 검증이 필요하다
- API 반환값의 모든 날짜는 **@JsonFormat** 통해 “2000-00-00 00시 00분 00초” 포맷으로 표기해야한다
- @Valid 검증 시 발생하거나 찾는 객체가 없는 등의 예외발생에 대해 **@ExceptionHandler** 예외처리가 필요
- API 자체 그리고 요청과 응답에 대해 **@Tag**, **@Operation**, **@Scheme** 입력하고 **Swagger** 페이지를 설정